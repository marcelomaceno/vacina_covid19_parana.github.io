---
title: "Personal Website"
---

Neste site têm-se dados de vacinação da Covid-19 no estado do Paraná para faixas de **80 anos ou mais**, **70 a 79 anos** e **60 a 69 anos**. Todas essas faixas de idade fazem parte do grupo prioriátio 2, conforme definido pela Secretaria de saúde do estado do Paraná, correspondendo a um total de 1.781.543 pessoas (44% do grupo prioriário - 4.080.010 pessoas).

### 80 anos ou mais
Nesta faixa de idade têm-se 250.630 pessoas. Até o momento

```{r, echo = FALSE, message=FALSE}
require(data.table)
require(lattice)
require(dplyr)
require(scales)
require(lubridate)

##############################################################
#DADOS DA VACINA                                             #
##############################################################
dados_vacina <- fread("https://s3-sa-east-1.amazonaws.com/ckan.saude.gov.br/PNI/vacina/uf/2021-03-20/uf%3DPR/part-00000-3e1f6b64-0846-4ae6-af4e-fe76601566fc.c000.csv", encoding = 'UTF-8')
dados_vacina$ind <- 1
dados_vacina$vacina_descricao_dose <- as.factor(dados_vacina$vacina_descricao_dose)
dados_vacina <- subset(dados_vacina, vacina_descricao_dose != levels(dados_vacina$vacina_descricao_dose)[3])
dados_vacina$semana <- epiweek(dados_vacina$vacina_dataAplicacao)
dados_vacina$faixaidade <- cut(dados_vacina$paciente_idade, c(0,59,69,79,Inf))
levels(dados_vacina$faixaidade) <- c("Menores de 60 anos","Entre 60 e 69 anos","Entre 70 e 79 anos","Acima de 80 anos")

#Primeira e segunda dose
prim_dose <- levels(dados_vacina$vacina_descricao_dose)[1]
seg_dose <- levels(dados_vacina$vacina_descricao_dose)[2]

#Total de pessoas por faixa etária
total80 <- 250630
total70 <- 537275
total60 <- 993908
totalmenos60 <- 4080010 - total80 - total70 - total60

grupos <- c(totalmenos60,total60,total70,total80)
indice <- c("Menores de 60 anos","Entre 60 e 69 anos","Entre 70 e 79 anos","Acima de 80 anos")
dados_vacina$grupos <- grupos[match(dados_vacina$faixaidade, indice)]

#Dados de vacinados para faixas de idade separados por semana
dados_vacina_agrup <- dados_vacina %>%
                      group_by(faixaidade, grupos, vacina_descricao_dose, semana)  %>%
                      summarize(incidencia = n()) %>%
                      mutate(soma = cumsum(incidencia)) %>%
                      mutate(perc = label_percent(accuracy = 1)(soma/grupos))

#############################################################
#DADOS DE CASOS DE COVID                                    #
#############################################################
dados_covid <- fread("https://www.saude.pr.gov.br/sites/default/arquivos_restritos/files/documento/2021-03/informe_epidemiologico_20_03_2021_geral.csv",
                     encoding = 'UTF-8')

dados_covid2 <- dados_covid
dados_covid2$DATA_DIAGNOSTICO <- as.Date(dados_covid2$DATA_DIAGNOSTICO, format="%d/%m/%Y")
dados_covid2$Ano <- format(dados_covid2$DATA_DIAGNOSTICO,"%Y")
dados_covid3 <- subset(dados_covid2, Ano == 2021 & DATA_DIAGNOSTICO > "2021-01-02")
dados_covid3$semana <- epiweek(dados_covid3$DATA_DIAGNOSTICO)
dados_covid3$faixaidade <- cut(dados_covid3$IDADE_ORIGINAL, c(0,59,69,79,Inf))
levels(dados_covid3$faixaidade) <- c("Menores de 60 anos","Entre 60 e 69 anos","Entre 70 e 79 anos","Acima de 80 anos")

#Número de casos de covid para faixas de idade separados por semana
dados_covid_casos <- dados_covid3 %>%
                     group_by(faixaidade, semana) %>%
                     summarize(incidencia = n()) %>%
                     mutate(acum = cumsum(incidencia)) %>%
                     mutate(grupo = "casos")

#Número de óbitos por covid separado por semana
dados_covid2 <- dados_covid
dados_covid2$DATA_OBITO <- as.Date(dados_covid2$DATA_OBITO, format="%d/%m/%Y")
dados_covid2$Ano <- format(dados_covid2$DATA_OBITO,"%Y")
dados_covid3 <- subset(dados_covid2, Ano == 2021 & DATA_OBITO > "2021-01-02")
dados_covid3$semana <- epiweek(dados_covid3$DATA_OBITO)
dados_covid3$faixaidade <- cut(dados_covid3$IDADE_ORIGINAL, c(0,59,69,79,Inf))
levels(dados_covid3$faixaidade) <- c("Menores de 60 anos","Entre 60 e 69 anos","Entre 70 e 79 anos","Acima de 80 anos")

dados_covid_obitos <- dados_covid3 %>%
                      group_by(faixaidade, semana) %>%
                      summarize(incidencia = n()) %>%
                      mutate(acum = cumsum(incidencia)) %>%
                      mutate(grupo = "óbitos")

#############################################################
#Gráficos                                                   #
#############################################################
dados_covid_uniao <- rbind(dados_covid_casos,dados_covid_obitos)
dados_covid_uniao$semana <- as.factor(dados_covid_uniao$semana)
levels(dados_covid_uniao$faixaidade)

#############################################################
#80 anos ou mais                                            #
#############################################################
dados_covid_casos2 <- subset(dados_covid_casos, faixaidade == "Acima de 80 anos")
dados_covid_obitos2 <- subset(dados_covid_obitos, faixaidade == "Acima de 80 anos")
dados_vacina_agrup2 <- subset(dados_vacina_agrup, faixaidade == "Acima de 80 anos")
dados_covid_uniao2 <- subset(dados_covid_uniao, faixaidade == "Acima de 80 anos")

dados_vacina_agrup2 <- rbind(data.frame(faixaidade = "Acima de 80 anos", grupos = 250630, vacina_descricao_dose = prim_dose, semana = 1, incidencia = 0, soma = 0, perc = "0%"),
                            dados_vacina_agrup2[1:10,],
                            data.frame(faixaidade = c("Acima de 80 anos","Acima de 80 anos"), grupos = c(250630,250630), vacina_descricao_dose = c(seg_dose,seg_dose), semana = c(1,2), incidencia = c(0,0), soma = c(0,0), perc = c("0%","0%")),
dados_vacina_agrup2[11:nrow(dados_vacina_agrup2),])
```

```{echo=FALSE, message=FALSE}

xyplot(incidencia ~ semana,
       group = grupo,
       type = "o",
       col = c(gray(0.6),gray(0.4)),
       lty = 1,
       pch = 19,
       cex = 0.9,
       ylab = NULL,
       xlab = "semana",
       scales = list(y=list(col=0)),
       data = dados_covid_uniao2,
       par.settings = list(axis.line = list(col = 0)),
       panel = function(x, y, ...) {
               panel.xyplot(x, y, ...)
               panel.text(x=dados_covid_casos2$semana,y=dados_covid_casos2$incidencia, labels = dados_covid_casos2$incidencia, 
                          col = grey(0.2), cex = 0.7, pos = 3, offset = 1)
               panel.text(x=dados_covid_obitos2$semana,y=dados_covid_obitos2$incidencia, labels = dados_covid_obitos2$incidencia, 
                          col = grey(0.2), cex = 0.7, pos = 3, offset = -2)
               panel.text(x=dados_covid_casos2$semana,y=dados_covid_casos2$incidencia, labels = subset(dados_vacina_agrup2, vacina_descricao_dose == prim_dose)$perc, 
                          col = grey(0.4), cex = 0.7, pos = 3, offset = 2)
               panel.text(x=dados_covid_casos2$semana,y=dados_covid_casos2$incidencia, labels = subset(dados_vacina_agrup2, vacina_descricao_dose == seg_dose)$perc, 
                          col = grey(0.6), cex = 0.7, pos = 3, offset = 3)
               panel.text(x=dados_covid_casos2$semana[1],y=dados_covid_casos2$incidencia[1], labels = "Casos", 
                          col = grey(0.2), cex = 0.7, pos = 4, offset = -3.5)
               panel.text(x=dados_covid_obitos2$semana[1],y=dados_covid_obitos2$incidencia[1], labels = "Óbitos", 
                          col = grey(0.2), cex = 0.7, pos = 4, offset = -3.5)
               panel.text(x=dados_covid_casos2$semana[1]-0.3,y=dados_covid_casos2$incidencia[1], labels = "1ª dose", 
                          col = grey(0.4), cex = 0.7, pos = 3, offset = 2)
               panel.text(x=dados_covid_casos2$semana[1]-0.3,y=dados_covid_casos2$incidencia[1], labels = "2ª dose", 
                          col = grey(0.6), cex = 0.7, pos = 3, offset = 3)
               panel.xyplot(x=c(dados_covid_casos2$semana[length(dados_covid_casos2$semana)-1],dados_covid_casos2$semana[length(dados_covid_casos2$semana)]),y=c(dados_covid_casos2$incidencia[length(dados_covid_casos2$incidencia)-1],dados_covid_casos2$incidencia[length(dados_covid_casos2$incidencia)]),
                            type = "o", col = grey(0.6), lty = 3, lwd = 2)
               panel.xyplot(x=c(dados_covid_obitos2$semana[length(dados_covid_obitos2$semana)-1],dados_covid_obitos2$semana[length(dados_covid_obitos2$semana)]),y=c(dados_covid_obitos2$incidencia[length(dados_covid_obitos2$incidencia)-1],dados_covid_obitos2$incidencia[length(dados_covid_obitos2$incidencia)]),
                            type = "o", col = grey(0.4), lty = 3, lwd = 2)
         })
```